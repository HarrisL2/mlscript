:NewDefs

// Test: Preserve behaviour of lambda vs let-binding
class G(val num: Int) {
    val x = 
        log("once on construction")
        num+2
    val y() =
        log("once every call")
        num+2
}
val g = new G(6)
g.y()
g.x
g.y()
g.x
//│ Lifted:
//│ TypingUnit {
//│   class G$1([val num: Int,]) {
//│     let x = {log("once on construction",); +((this).num, 2,)}
//│     let y = () => {log("once every call",); +((this).num, 2,)}
//│   }
//│   let g$1 = new G$1([6,]) {}
//│   Code(List((g$1).y()))
//│   Code(List((g$1).x))
//│   Code(List((g$1).y()))
//│   Code(List((g$1).x))
//│ }
//│ class G(num: Int) {
//│   val x: Int
//│   val y: () -> Int
//│ }
//│ val g: G
//│ Int
//│ g
//│   = G {}
//│ // Output
//│ once on construction
//│ res
//│     = 8
//│ // Output
//│ once every call
//│ res
//│     = 8
//│ res
//│     = 8
//│ // Output
//│ once every call
//│ res
//│     = 8

class X() {
    val a = 
        log("ok")
        6
}
val object = X()
(new X()).a
(new X()).a
object.a
object.a
//│ Lifted:
//│ TypingUnit {
//│   class X$1([]) {let a = {log("ok",); 6}}
//│   let object$1 = X$1()
//│   Code(List(('(' new X$1([]) {} ')').a))
//│   Code(List(('(' new X$1([]) {} ')').a))
//│   Code(List((object$1).a))
//│   Code(List((object$1).a))
//│ }
//│ class X() {
//│   val a: 6
//│ }
//│ val object: X
//│ 6
//│ object
//│        = X {}
//│ // Output
//│ ok
//│ res
//│     = 6
//│ // Output
//│ ok
//│ res
//│     = 6
//│ // Output
//│ ok
//│ res
//│     = 6
//│ res
//│     = 6
